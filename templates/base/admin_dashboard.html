{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
  .mention-textarea {
    font-family: 'Arial';
    color: rgb(20, 95, 245);
    font-weight: bold;
  }
</style>

<main role="main" class="main-content">
  <div class="container-fluid">
    <div class="row justify-content-center">
      <div class="col-12">
        <div class="row">
          <div class="col-md-6 col-xl-3 mb-4">
            <div class="card shadow bg-primary text-white border-0">
              <div class="card-body">
                <div class="row align-items-center">
                  <div class="col-3 text-center">
                    <span class="circle circle-sm bg-primary-light">
                      <i class="fe fe-16 fe-shopping-bag text-white mb-0"></i>
                    </span>
                  </div>

                  <div class="col pr-0">
                    <p class="small text-muted mb-0">All Leads</p>
                    <span class="h3 mb-0 text-white">{{ all_leads_count }}</span>
                    <!-- Add other relevant styling and content -->
                  </div>

                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6 col-xl-3 mb-4">
            <div class="card shadow border-0">
              <div class="card-body">
                <div class="row align-items-center">
                  <div class="col-3 text-center">
                    <span class="circle circle-sm bg-primary">
                      <i class="fe fe-16 fe-shopping-cart text-white mb-0"></i>
                    </span>
                  </div>
                  <div class="col pr-0">
                    <p class="small text-muted mb-0">Number of Sign√© CPF</p>
                   
                    <span class="h3 mb-0">{{ signe_cpf_leads_count }}</span>

                   
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6 col-xl-3 mb-4">
            <div class="card shadow border-0">
              <div class="card-body">
                <div class="row align-items-center">
                  <div class="col-3 text-center">
                    <span class="circle circle-sm bg-primary">
                      <i class="fe fe-16 fe-filter text-white mb-0"></i>
                    </span>
                  </div>
                  <div class="col">
                      <p class="small text-muted mb-0">Conversion</p>
                      <div class="row align-items-center no-gutters">
                          <div class="col-auto">
                              <span class="h3 mr-2 mb-0">{{ conversion_rate|floatformat:1 }}%</span>
                          </div>
                          <div class="col-md-12 col-lg">
                              <div class="progress progress-sm mt-2" style="height:3px">
                                  <div class="progress-bar bg-success" role="progressbar" style="width: {{ conversion_rate }}%" aria-valuenow="{{ conversion_rate }}" aria-valuemin="0" aria-valuemax="100"></div>
                              </div>
                          </div>
                      </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6 col-xl-3 mb-4">
            <div class="card shadow border-0">
              <div class="card-body">
                <div class="row align-items-center">
                  <div class="col-3 text-center">
                    <span class="circle circle-sm bg-primary">
                      <i class="fe fe-16 fe-activity text-white mb-0"></i>
                    </span>
                  </div>
                  <div class="col">
                    <p class="small text-muted mb-0">AVG Orders</p>
                    <span class="h3 mb-0">$80</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div> <!-- end section -->
        <div class="row align-items-center my-2">
          <div class="col-auto ml-auto">
            <form class="form-inline">
              <div class="form-group">
                <label for="reportrange" class="sr-only">Date Ranges</label>
                <div id="reportrange" class="px-2 py-2 text-muted">
                  <i class="fe fe-calendar fe-16 mx-2"></i>
                  <span class="small"></span>
                </div>
              </div>
              <div class="form-group">
                <button type="button" class="btn btn-sm"><span
                    class="fe fe-refresh-ccw fe-12 text-muted"></span></button>
                <button type="button" class="btn btn-sm"><span class="fe fe-filter fe-12 text-muted"></span></button>
              </div>
            </form>
          </div>
        </div>
        <!-- charts-->
        <div class="row my-4">
          <div class="col-md-12">
            <div class="chart-box">
              <div id="columnChart"></div>
            </div>
          </div> <!-- .col -->
        </div> <!-- end section -->
        <!-- info small box -->
        <div class="row">
          <div class="col-md-4">
            <div class="card shadow mb-4">
              <div class="card-body">
                <div class="chart-widget">
                  <div id="gradientRadial"></div>
                </div>
                <div class="row">
                  <div class="col-6 text-center">
                    <p class="text-muted mb-0">Yesterday</p>
                    <h4 class="mb-1">126</h4>
                    <p class="text-muted mb-2">+5.5%</p>
                  </div>
                  <div class="col-6 text-center">
                    <p class="text-muted mb-0">Today</p>
                    <h4 class="mb-1">86</h4>
                    <p class="text-muted mb-2">-5.5%</p>
                  </div>
                </div>
              </div> <!-- .card-body -->
            </div> <!-- .card -->
          </div> <!-- .col -->
          <div class="col-md-4">
            <div class="card shadow mb-4">
              <div class="card-body">
                <div class="chart-widget mb-2">
                  <div id="radialbar"></div>
                </div>
                <div class="row items-align-center">
                  <div class="col-4 text-center">
                    <p class="text-muted mb-1">Cost</p>
                    <h6 class="mb-1">$1,823</h6>
                    <p class="text-muted mb-0">+12%</p>
                  </div>
                  <div class="col-4 text-center">
                    <p class="text-muted mb-1">Revenue</p>
                    <h6 class="mb-1">$6,830</h6>
                    <p class="text-muted mb-0">+8%</p>
                  </div>
                  <div class="col-4 text-center">
                    <p class="text-muted mb-1">Earning</p>
                    <h6 class="mb-1">$4,830</h6>
                    <p class="text-muted mb-0">+8%</p>
                  </div>
                </div>
              </div> <!-- .card-body -->
            </div> <!-- .card -->
          </div> <!-- .col -->
          <div class="col-md-4">
            <div class="card shadow mb-4">
              <div class="card-body">
                <p class="mb-0"><strong class="mb-0 text-uppercase text-muted">Today</strong></p>
                <h3 class="mb-0">$2,562.30</h3>
                <p class="text-muted">+18.9% Last week</p>
                <div class="chart-box mt-n5">
                  <div id="lineChartWidget"></div>
                </div>
                <div class="row">
                  <div class="col-4 text-center mt-3">
                    <p class="mb-1 text-muted">Completions</p>
                    <h6 class="mb-0">26</h6>
                    <span class="small text-muted">+20%</span>
                    <span class="fe fe-arrow-up text-success fe-12"></span>
                  </div>
                  <div class="col-4 text-center mt-3">
                    <p class="mb-1 text-muted">Goal Value</p>
                    <h6 class="mb-0">$260</h6>
                    <span class="small text-muted">+6%</span>
                    <span class="fe fe-arrow-up text-success fe-12"></span>
                  </div>
                  <div class="col-4 text-center mt-3">
                    <p class="mb-1 text-muted">Conversion</p>
                    <h6 class="mb-0">6%</h6>
                    <span class="small text-muted">-2%</span>
                    <span class="fe fe-arrow-down text-danger fe-12"></span>
                  </div>
                </div>
              </div> <!-- .card-body -->
            </div> <!-- .card -->
          </div> <!-- .col-md -->
          <div class="col-md-6">
            <div class="card shadow mb-4">
              <div class="card-body">
                <div class="card-title">
                  <strong>Products</strong>
                  <a class="float-right small text-muted" href="#!">View all</a>
                </div>
                <div class="row">
                  <div class="col-md-12">
                    <div id="chart-box">
                      <div id="donutChartWidget"></div>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="row align-items-center my-3">
                      <div class="col">
                        <strong>Cloud Server</strong>
                        <div class="my-0 text-muted small">Global, Services</div>
                      </div>
                      <div class="col-auto">
                        <strong>+85%</strong>
                      </div>
                      <div class="col-3">
                        <div class="progress" style="height: 4px;">
                          <div class="progress-bar" role="progressbar" style="width: 85%" aria-valuenow="85"
                            aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                      </div>
                    </div>
                    <div class="row align-items-center my-3">
                      <div class="col">
                        <strong>CDN</strong>
                        <div class="my-0 text-muted small">Global, Services</div>
                      </div>
                      <div class="col-auto">
                        <strong>+75%</strong>
                      </div>
                      <div class="col-3">
                        <div class="progress" style="height: 4px;">
                          <div class="progress-bar" role="progressbar" style="width: 75%" aria-valuenow="75"
                            aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                      </div>
                    </div>
                    <div class="row align-items-center my-3">
                      <div class="col">
                        <strong>Databases</strong>
                        <div class="my-0 text-muted small">Local, DC</div>
                      </div>
                      <div class="col-auto">
                        <strong>+62%</strong>
                      </div>
                      <div class="col-3">
                        <div class="progress" style="height: 4px;">
                          <div class="progress-bar" role="progressbar" style="width: 62%" aria-valuenow="62"
                            aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                      </div>
                    </div>
                  </div> <!-- .col-md-12 -->
                </div> <!-- .row -->
              </div> <!-- .card-body -->
            </div> <!-- .card -->
          </div> <!-- .col-md -->
          <div class="col-md-6">
            <div class="card shadow mb-4">
              <div class="card-body">
                <div class="card-title">
                  <strong>Region</strong>
                  <a class="float-right small text-muted" href="#!">View all</a>
                </div>
                <div class="map-box" style="position: relative; width: 350px; min-height: 130px; margin:0 auto;">
                  <div id="dataMapUSA"></div>
                </div>
                <div class="row align-items-center h-100 my-2">
                  <div class="col">
                    <p class="mb-0">France</p>
                    <span class="my-0 text-muted small">+10%</span>
                  </div>
                  <div class="col-auto text-right">
                    <span>118</span><br />
                    <div class="progress mt-2" style="height: 4px;">
                      <div class="progress-bar" role="progressbar" style="width: 85%" aria-valuenow="85"
                        aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                </div>
                <div class="row align-items-center my-2">
                  <div class="col">
                    <p class="mb-0">Netherlands</p>
                    <span class="my-0 text-muted small">+0.6%</span>
                  </div>
                  <div class="col-auto text-right">
                    <span>1008</span><br />
                    <div class="progress mt-2" style="height: 4px;">
                      <div class="progress-bar" role="progressbar" style="width: 85%" aria-valuenow="85"
                        aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                </div>
                <div class="row align-items-center my-2">
                  <div class="col">
                    <p class="mb-0">Italy</p>
                    <span class="my-0 text-muted small">+1.6%</span>
                  </div>
                  <div class="col-auto text-right">
                    <span>67</span><br />
                    <div class="progress mt-2" style="height: 4px;">
                      <div class="progress-bar" role="progressbar" style="width: 85%" aria-valuenow="85"
                        aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                </div>
                <div class="row align-items-center my-2">
                  <div class="col">
                    <p class="mb-0">Spain</p>
                    <span class="my-0 text-muted small">+118%</span>
                  </div>
                  <div class="col-auto text-right">
                    <span>186</span><br />
                    <div class="progress mt-2" style="height: 4px;">
                      <div class="progress-bar" role="progressbar" style="width: 85%" aria-valuenow="85"
                        aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div> <!-- .col -->
        </div> <!-- / .row -->
        <div class="row">
          <!-- Recent orders -->
          <div class="col-md-12">
            <h6 class="mb-3">Last orders</h6>
            <table id="priceTable" class="table table-borderless table-striped">
              <thead>
                <tr role="row">
                  <th>User</th>
                  <th>Monday</th>
                  <th>Tuesday</th>
                  <th>Wednesday</th>
                  <th>Thursday</th>
                  <th>Friday</th>
                  <th>Saturday</th>
                  <th>Sunday</th>
                </tr>
              </thead>
              <tbody>
                <!-- Populate this section with user and price data using JavaScript -->
              </tbody>
            </table>
          </div> <!-- / .col-md-3 -->
        </div> <!-- end section -->
      </div>
    </div> <!-- .row -->
  </div> <!-- .container-fluid -->

</main> <!-- main -->
</div> <!-- .wrapper -->
{% endblock %}
{% block javascript %}
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.1/css/select.bootstrap.css" />
<script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
<script>
  function updateTable(data) {
    var tableBody = $('#priceTable tbody');
    tableBody.empty(); // Clear existing rows
  
    // Create an array of weekdays in the correct order
    var weekdays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
  
    // Iterate through the data and populate the table
    $.each(data, function(username, userData) {
      var row = $('<tr></tr>');
      row.append($('<td></td>').text(userData.username)); // Use userData.username instead of username
  
      // Add the price values for each day of the week in the correct order
      for (var i = 0; i < weekdays.length; i++) {
        var day = weekdays[i];
        var price = userData.prices[day] || '0'; // Access prices using userData.prices
        var roundedPrice = parseFloat(price).toFixed(2); 
        row.append($('<td></td>').text(roundedPrice));
      }
  
      tableBody.append(row);
    });
  }
  
  $(document).ready(function() {
    $.ajax({
      url: '{% url "fetch_price_data" %}',
      method: 'GET',
      dataType: 'json',
      success: function(data) {
        // Update the table with fetched data
        console.log(data)
        updateTable(data);
      },
      error: function() {
        console.error('Failed to fetch price data.');
      }
    });
  });
</script>
{% endblock %}